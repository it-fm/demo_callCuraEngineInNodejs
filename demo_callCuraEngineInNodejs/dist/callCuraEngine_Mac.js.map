{"version":3,"sources":["callCuraEngine_Mac.js"],"names":["child_process","require","spawn","sliceProgress","filamentLength","filamentWeight","printTime","curaEnginePath","configPath","gcodePath","getGcodePath","stlPath","wmic","stdout","on","data","stderr","array","toString","split","map","item","length","indexOf","start","end","Number","slice","console","log","replace","Math","PI","code","date","Date","gcodeFileName","getHours","getMinutes","getSeconds"],"mappings":";;AAAA,IAAIA,gBAAgBC,QAAQ,eAAR,CAApB;AACA,IAAIC,QAAQF,cAAcE,KAA1B;;AAEA,IAAIC,aAAJ,EAAmBC,cAAnB,EAAmCC,cAAnC,EAAmDC,SAAnD;;AAEA,IAAIC,iBAAe,8BAAnB;AACA,IAAIC,aAAW,8CAAf;AACA,IAAIC,YAAYC,cAAhB;AACA,IAAIC,UAAQ,aAAZ;;AAEA;;AAEA,IAAIC,OAAOV,MAAMK,cAAN,EAAsB,CAAC,OAAD,EAAU,IAAV,EAAgB,IAAhB,EAAsB,IAAtB,EAA4BC,UAA5B,EAAwC,IAAxC,EAA8CC,SAA9C,EAAyD,IAAzD,EAA+DE,OAA/D,CAAtB,CAAX;;AAEAC,KAAKC,MAAL,CAAYC,EAAZ,CAAe,MAAf,EAAuB,UAASC,IAAT,EAAe,CAErC,CAFD;;AAIAH,KAAKI,MAAL,CAAYF,EAAZ,CAAe,MAAf,EAAuB,UAASC,IAAT,EAAe;;AAErC,KAAIE,QAAQF,KAAKG,QAAL,GAAgBC,KAAhB,CAAsB,IAAtB,CAAZ;;AAEAF,OAAMG,GAAN,CAAU,UAAUC,IAAV,EAAgB;;AAEzB,MAAIA,KAAKC,MAAL,GAAc,EAAlB,EAAqB;AACpB;AACA;;AAED,MAAGD,KAAKE,OAAL,CAAa,sBAAb,MAAyC,CAAzC,IAA8CF,KAAKE,OAAL,CAAa,kBAAb,MAAqC,CAAtF,EAAwF;;AAEvF,OAAIC,QAAQH,KAAKE,OAAL,CAAa,IAAb,CAAZ;AACA,OAAIE,MAAMJ,KAAKE,OAAL,CAAa,GAAb,CAAV;AACApB,mBAAgBuB,OAAOL,KAAKM,KAAL,CAAWH,KAAX,EAAkBC,GAAlB,CAAP,CAAhB;AACAG,WAAQC,GAAR,CAAY,sBAAsB1B,aAAlC;AAEA,GAPD,MAOM,IAAGkB,KAAKE,OAAL,CAAa,iBAAb,MAAoC,CAAvC,EAAyC;;AAE9CnB,oBAAiBsB,OAAOL,KAAKS,OAAL,CAAa,iBAAb,EAA+B,EAA/B,EAAmCA,OAAnC,CAA2C,GAA3C,EAA+C,EAA/C,CAAP,CAAjB;AACAzB,oBAAiB0B,KAAKC,EAAL,IAAW,OAAO,CAAlB,KAAwB,OAAO,CAA/B,IAAoC5B,cAApC,GAAqD,IAAtE;AACAD,mBAAgB,CAAhB;AAEA,GANK,MAMA,IAAGkB,KAAKE,OAAL,CAAa,aAAb,MAAgC,CAAnC,EAAqC;;AAE1C;AACAjB,eAAYoB,OAAOL,KAAKS,OAAL,CAAa,aAAb,EAA2B,EAA3B,CAAP,IAAyC,IAArD;AACA3B,mBAAgB,CAAhB;AAEA;AAED,EA3BD;AA6BA,CAjCD;;AAmCAS,KAAKE,EAAL,CAAQ,OAAR,EAAiB,UAASmB,IAAT,EAAe;;AAE/BL,SAAQC,GAAR,CAAY,wCAAZ;;AAEA;AACAD,SAAQC,GAAR,CAAY,oCAAoCI,IAAhD;;AAEAL,SAAQC,GAAR,CAAY,sBAAsB1B,aAAlC;AACAyB,SAAQC,GAAR,CAAY,sBAAsBzB,cAAlC;AACAwB,SAAQC,GAAR,CAAY,sBAAsBxB,cAAlC;AACAuB,SAAQC,GAAR,CAAY,iBAAiBvB,SAA7B;;AAEAsB,SAAQC,GAAR,CAAY,wCAAZ;AAEA,CAdD;;AAgBA,SAASnB,YAAT,GAAwB;;AAEvB,KAAIwB,OAAO,IAAIC,IAAJ,EAAX;AACA,KAAIC,gBAAgBF,KAAMG,QAAN,KAAmB,GAAnB,GAAyBH,KAAMI,UAAN,EAAzB,GAA8C,GAA9C,GAAoDJ,KAAMK,UAAN,EAAxE;AACA,QAAO,QAAQH,aAAR,GAAwB,QAA/B;AAEA","file":"callCuraEngine_Mac.js","sourcesContent":["var child_process = require('child_process');\nvar spawn = child_process.spawn;\n\nvar sliceProgress, filamentLength, filamentWeight, printTime;\n\nvar curaEnginePath=\"../CuraEngine/Mac/CuraEngine\";\nvar configPath=\"../CuraEngine/Config/normal_quality.def.json\";\nvar gcodePath = getGcodePath();\nvar stlPath=\"../test.stl\";\n\n//exec \"$curaEnginePath\" slice -v -p -j \"$configPath\" -o \"$gcodePath\" -l \"$stlPath\"\n\nvar wmic = spawn(curaEnginePath, ['slice', '-v', '-p', '-j', configPath, '-o', gcodePath, '-l', stlPath]);\n\nwmic.stdout.on('data', function(data) {\n\n});\n\nwmic.stderr.on('data', function(data) {\n\n\tvar array = data.toString().split('\\n');\n\n\tarray.map(function (item) {\n\n\t\tif (item.length < 10){\n\t\t\treturn;\n\t\t}\n\n\t\tif(item.indexOf('Progress:inset+skin:') === 0 || item.indexOf('Progress:export:') === 0){\n\n\t\t\tvar start = item.indexOf('0.');\n\t\t\tvar end = item.indexOf('%');\n\t\t\tsliceProgress = Number(item.slice(start, end));\n\t\t\tconsole.log('slice progress = ' + sliceProgress);\n\n\t\t}else if(item.indexOf(';Filament used:') === 0){\n\n\t\t\tfilamentLength = Number(item.replace(';Filament used:','').replace('m',''));\n\t\t\tfilamentWeight = Math.PI * (1.75 / 2) * (1.75 / 2) * filamentLength * 1.24;\n\t\t\tsliceProgress = 1;\n\n\t\t}else if(item.indexOf('Print time:') === 0){\n\n\t\t\t//add empirical parameter : 1.07\n\t\t\tprintTime = Number(item.replace('Print time:','')) * 1.07;\n\t\t\tsliceProgress = 1;\n\n\t\t}\n\n\t});\n\n});\n\nwmic.on('close', function(code) {\n\n\tconsole.log('**************************************');\n\n\t//0:ok  1:error\n\tconsole.log('child process exited with code ' + code);\n\n\tconsole.log('slice progress = ' + sliceProgress);\n\tconsole.log('filamentLength = ' + filamentLength);\n\tconsole.log('filamentWeight = ' + filamentWeight);\n\tconsole.log('printTime = ' + printTime);\n\n\tconsole.log('**************************************');\n\n});\n\nfunction getGcodePath() {\n\n\tvar date = new Date();\n\tvar gcodeFileName = date .getHours() + \"-\" + date .getMinutes() + \"-\" + date .getSeconds();\n\treturn \"../\" + gcodeFileName + \".gcode\"\n\n}\n\n\n\n\n\n"],"sourceRoot":"/Users/liuming/github/demo_callCuraEngineInNodejs/demo_callCuraEngineInNodejs/src"}